# Resolving Client-Side Routing Issues in Azure Static Web Apps

## Introduction

Single Page Applications (SPAs) often rely on client-side routing, where routing rules are handled on the client-side without making requests back to the server. When using Azure Static Web Apps, refreshing the page or directly accessing URLs generated by client-side routing may result in a 404 error. To address this, you can define a server-side fallback route using the `navigationFallback` configuration.

## Step 1: Create or Update `staticwebapp.config.json`

1. Create a `staticwebapp.config.json` file in the root of your project or update it if it already exists.

2. Add the following configuration to the file to serve `/index.html` for all static file requests that don't match a deployed file:

   ```json
   {
     "navigationFallback": {
       "rewrite": "/index.html"
     }
   }
   ```

## Step 2: Exclude Certain Routes from Fallback

3. If you want to control which requests return the fallback file, you can define a filter. For example, to exclude requests for certain routes in the `/images` folder and all files in the `/css` folder, use the following configuration:

   ```json
   {
     "navigationFallback": {
       "rewrite": "/index.html",
       "exclude": ["/images/*.{png,jpg,gif}", "/css/*"]
     }
   }
   ```

   With the directory structure below, the navigation fallback rule would result in the following outcomes:

   ```
   files
   ├── images
   │   ├── logo.png         // Excluded from fallback
   │   ├── headshot.jpg     // Excluded from fallback
   │   └── screenshot.gif   // Excluded from fallback
   │
   ├── css
   │   └── global.css       // Excluded from fallback
   │
   └── index.html            // Fallback file
   ```

## Step 3: File Placement and Build Output

4. Ensure that the `staticwebapp.config.json` file is placed in the folder set as the `app_location` in your [workflow file](https://learn.microsoft.com/en-us/azure/static-web-apps/build-configuration?tabs=github-actions). It can also be placed in any subfolder within the `app_location`.

5. If there is a build step in your workflow, make sure the build outputs the `staticwebapp.config.json` file to the root of the `output_location`.

## Step 4: Deploy to Azure Static Web Apps

6. Deploy your application to Azure Static Web Apps. The routing configuration specified in the `staticwebapp.config.json` file will be used to handle client-side routing.

## Additional Resources

For further information and detailed configurations, refer to the [official Microsoft Azure Static Web Apps documentation](https://learn.microsoft.com/en-us/azure/static-web-apps/configuration). 
The documentation provides the latest and most accurate information on configuring Azure Static Web Apps.

Feel free to consult the documentation for any updates or additional troubleshooting tips.
